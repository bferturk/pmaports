# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=konversation
pkgver=1.7.5_git20180703
pkgrel=0
_commit="63acdfe89198823739514822f9a2950bf3d4c61b"
pkgdesc="A user-friendly and fully-featured IRC client"
arch="all"
url='https://konversation.kde.org/'
license="GPL-2.0"
depends="kirigami2 qt5-qtquickcontrols kdeclarative"
makedepends="$depends_dev extra-cmake-modules qt5-qtbase-dev qt5-qtdeclarative-dev karchive-dev kbookmarks-dev kconfig-dev kconfigwidgets-dev kcoreaddons-dev kcrash-dev kemoticons-dev ki18n-dev kidletime-dev knotifyconfig-dev kio-dev kparts-dev solid-dev kwidgetsaddons-dev kglobalaccel-dev kdbusaddons-dev knotifications-dev kwindowsystem-dev kiconthemes-dev kitemviews-dev kitemmodels-dev kpackage-dev kwallet-dev kdoctools-dev qca-qt5-dev"
source="$pkgname-$_commit.tar.gz::https://github.com/kde/$pkgname/archive/$_commit.tar.gz"
subpackages=""
# options="!check" # Fails due to requiring running X11
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DKDE_INSTALL_LIBDIR=lib \
		-DKDE_INSTALL_LIBEXECDIR=lib \
		-DLIBC_IS_GLIBC=0
	
	make
}

check() {
	cd "$builddir"
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}
sha512sums="12cd70fca27e819b4ec107c9154fe4e909be253ac1b2092f63a49362060e368d59cc3d63ce1ac817af5ac4901f6e86313fcfcb0e681d5796037f02deb46f3414  konversation-63acdfe89198823739514822f9a2950bf3d4c61b.tar.gz"
